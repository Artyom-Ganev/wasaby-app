<!DOCTYPE html>
<html>
    <head>
        <script src="https://requirejs.org/docs/release/2.3.6/comments/require.js"></script>
        <script>
            require.config({
                baseUrl: "/src",
                paths: {
                    "react": "https://unpkg.com/react@16/umd/react.development",
                    "react-dom": "https://unpkg.com/react-dom@16.7.0/umd/react-dom.development"
                }
            });
        </script>
    </head>
    <body>
        <div id="root"></div>
        <script src="/src/Application/Initializer.js"></script>
        <script>
            const serverState = {
                "root": { "name": "server value!" }
            };
            require([
                "Application/Initializer",
                "Application/Env",
                "Application/Config",
                "Application/_Env/Browser/StateReceiver"],
            (AppInit, { EnvBrowser, getLogger, LogLevel }, Config, StateReceiver) => {
                const cfg = {
                    "Application/Env.LogLevel": LogLevel.info,
                    someKey: false,
                    foo: 'bar',
                    baz: 5
                };
                let request = AppInit.default(cfg, EnvBrowser, new StateReceiver.default(serverState));
                getLogger().info("Info", Config.get("someKey"));
                getLogger().warning("Warning", Config.get("foo"));
                getLogger().error("Error: ", Config.get("baz"));
             });
        </script>
        <script>
            require(["react", "react-dom", "Application/Initializer", "Application/Env"], function (React, ReactDOM, { registerComponent }, { getLogger }) {
                class Welcome extends React.Component {
                    constructor(props) {
                        super(props);
                    }
                    render() {
                        getLogger().info("React render Welcome, props:", this.props);
                        return React.createElement("h1", null, "Hello, ", this.props.name);
                    }
                }

                class MyComponent {
                    constructor() {
                        this.setState({ name: "client value!" });
                    }
                    getState() {
                        return this.state;
                    }
                    setState(state) {
                        if (!state) { return; }
                        this.state = state;
                        const element = React.createElement(Welcome, { name: state.name });
                        ReactDOM.render(element, document.getElementById("root"));
                    }
                }
                registerComponent("root", new MyComponent());
            });
        </script>
    </body>
</html>